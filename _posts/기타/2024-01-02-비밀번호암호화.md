---
title: λΉ„λ°€λ²νΈ μ•”νΈν™” (crypto,Bcrypt)
date: 2024-01-02 18:24:00 +09:00
categories: ["κΈ°νƒ€", "λΉ„λ°€λ²νΈ_μ•”νΈν™”"]
tags: []
toc: true
toc_sticky: true
---

κ°•μλ¥Ό λ“£κΈ° μ „μ— λΉ„λ°€λ²νΈ μ•”νΈν™”λ΅ μ λ…ν• `Bcrypt` λΌμ΄λΈλ¬λ¦¬λ¥Ό μ‚¬μ©ν•μ—¬ νμ›κ°€μ…ν• μ μ €μ λΉ„λ°€λ²νΈλ¥Ό μ•”νΈν™”ν•λ” λ΅μ§μ„ μ‘μ„±ν–μ—λ‹¤. μ¤λ λ¶€νΈμΊ ν”„ κ°•μλ¥Ό λ“¤μΌλ©° κ°•μ‚¬λ‹μ΄ nodejsμ λ‚΄μ¥ λ¨λ“μΈ `crypto`λ¥Ό μ‚¬μ©ν•΄μ„ μ•”νΈν™”ν•λ” λ‚΄μ©μ„ λ³΄κ³  μ°¨μ΄μ μ΄ κ¶κΈν•΄ μ¶”κ°€λ΅ ν•™μµν•μ€λ‹¤.

## π“•λΉ„λ°€λ²νΈ μ•”νΈν™” λ°©μ‹

### #λ‹¨λ°©ν–¥ μ•”νΈν™”

ν‰λ¬Έμ„ μ•”νΈν™”μ‹ν‚¬ μ μμ  
λ‹¨, μ•”νΈν™”λ¥Ό ν‰λ¬ΈμΌλ΅ λ³€ν™μ€ ν•  μ μ—†μ

### #μ–‘λ°©ν–¥ μ•”νΈν™”

ν‰λ¬Έμ„ μ•”νΈν™” μ‹ν‚¬ μ μμΌλ©°, μ•”νΈν™”λ¥Ό ν‰λ¬ΈμΌλ΅ λ³€ν™ν•  μ μμ

**λΉ„λ°€λ²νΈλ” λ³ΈμΈλ§μ΄ μ•κ³  μμ–΄μ•Όν•κΈ°λ•λ¬Έμ—, λ‹¨λ°©ν–¥ μ•”νΈν™” λ°©μ‹μ„ μ‚¬μ©ν•λ‹¤.**

## π“•Crypto

[κ³µμ‹ λ¬Έμ„ - node.js v.20.xx.x](https://nodejs.org/docs/latest-v20.x/api/crypto.html#crypto)

Node.jsμ λ‚΄μ¥ λ¨λ“, μ—¬λ¬ ν•΄μ‹ ν•¨μλ¥Ό μ‚¬μ©ν•μ—¬ μ•”νΈν™” κΈ°λ¥μ„ μ κ³µν•λ‹¤.

λ‹¨μ Hashλ¥Ό ν†µν• μ•”νΈν™”λ” λ³΄μ•μ— μ·¨μ•½ν•κΈ° λ•λ¬Έμ—,**Saltκ°’κ³Ό λ‹¤μ¤‘ Hashν•¨μ**λ¥Ό ν†µν•΄ λ³΄μ•μ„±μ„ κ°•ν™”μ‹μΌμ¤€λ‹¤.

### `pbkdf2`

`crypto.pbkdf2(password, salt, iterations, keylen, digest, callback)`

- password: ν•΄μ‹λκΈ°λ¥Ό μ›ν•λ” λΉ„λ°€λ²νΈ
- salt : λ¬΄μ‘μ„λ΅ λ°μ΄ν„°λ¥Ό νΌν•©μ‹ν‚¤λ” κ°’
- iterations : μ•κ³ λ¦¬μ¦μ΄ λ°λ³µλλ” νμ
- keylen : μƒμ„±λλ” ν‚¤μ κΈΈμ΄
- digest : μ‚¬μ©ν•  ν•΄μ‹ ν•¨μ ('sha256', 'sha512')
- callback : κ³„μ‚°μ΄ μ™„λ£λλ©΄ νΈμ¶ν•  λΉ„λ™κΈ° μ½λ°± ν•¨μ

### #μ•”νΈν™”ν•κΈ°

```js
const crypto = require("crypto");

const password = "mySecretPassword";
const salt = crypto.randomBytes(16).toString("hex"); // λ¬΄μ‘μ„ μ†”νΈ μƒμ„±
const iterations = 100000; // μ μ ν• λ°λ³µ νμ μ„ νƒ
const keylen = 64; // μƒμ„±λλ” ν‚¤μ κΈΈμ΄
const digest = "sha512"; // ν•΄μ‹ ν•¨μ μ„ νƒ

crypto.pbkdf2(password, salt, iterations, keylen, digest, (err, derivedKey) => {
  if (err) throw err;
  console.log("Derived Key:", derivedKey.toString("hex"));
});
```

### #κ²€μ¦ν•κΈ°

λ‹¨λ°©ν–¥ μ•”νΈν™”μ΄κΈ°λ•λ¬Έμ— λ³µνΈν™”λ¥Ό ν•  μ μ—†λ‹¤. λ”°λΌ μ μ €κ°€ μ…λ ¥ν• passwordλ„ μ•”νΈν™”ν•΄μ„ μ•”νΈν™”λμ–΄μλ” λΉ„λ°€λ²νΈμ™€ λΉ„κµν•΄μ•Όν•λ‹¤.

```js
const password = "μ μ €κ°€ μƒλ΅­κ² μ…λ ¥ν• λΉ„λ°€λ²νΈ";
const userPassword = "λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥λμ–΄μλ” λΉ„λ°€λ²νΈ";

const verifyPassword = (password, userSalt, userPassword) => {
  const key = pbkdf2Promise(password, userSalt, 99999, 64, "sha512");
  const hashedPassword = key.toString("base64");
  if (hashedPassword === userPassword) return true;
  return false;
};
```

#### β€» μ£Όμ

νμ›κ°€μ… μ‹ μ•”νΈν™”λ λΉ„λ°€λ²νΈμ™€ salt κ°’μ„ κ°™μ΄ μ €μ¥ν•΄μ•Όν•¨

## π“•Bcrypt

[κΉƒν—λΈ λ¬Έμ„](https://github.com/kelektiv/node.bcrypt.js)

μ•”νΈλ¥Ό ν•΄μ‹ν•λ”λ° κ°€μ¥ λ§μ΄ μ‚¬μ©ν•λ” λΌμ΄λΈλ¬λ¦¬ μ¤‘ ν•λ‚μ΄λ‹¤. ν•΄μ‹±μ— λλ¦¬κ³  λΉ„μ©μ΄ λ§μ΄ λ“λ” Blowfish μ•κ³ λ¦¬μ¦μΌλ΅ κµ¬ν„λμ–΄μλ‹¤.

λ™κΈ°μ  λ°©μ‹, λΉ„λ™κΈ°μ  λ°©μ‹ λ¨λ‘ μ‚¬μ©ν•  μ μμ§€λ§ λ¬Έμ„μ—μ„λ” λΉ„λ™κΈ°μ  λ°©μ‹μ„ μ‚¬μ©ν•λ” κ²ƒμ„ κ¶μ¥ν•λ‹¤. (CPUλ¥Ό λ§μ΄ μ‚¬μ©ν•κΈ° λ•λ¬Έμ—)

### #μ„¤μΉ

```bash
npm install bcrypt
```

### #μ•”νΈν™”ν•κΈ°

λ™κΈ°: `hash(data, salt, cb);`  
λΉ„λ™κΈ°: `hashSync(data, salt);`

- data : μ•”νΈν™”ν•  λ°μ΄ν„°
- salt : λΉ„λ°€λ²νΈλ¥Ό ν•΄μ‹ν•λ” λ° μ‚¬μ©λλ” μ†”νΈ
- cb : λ°μ΄ν„°κ°€ μ•”νΈν™”λλ©΄ μ‹¤ν–‰λλ” μ½λ°± (μ„ νƒ)

```js
const bcrypt = require("bcrypt");

bcrypt.hash(password, 10);
bcrypt.hashSync(password, 10);
```

### #λΉ„λ°€λ²νΈ λΉ„κµν•κΈ°

λ™κΈ°: `compare(data, encrypted, cb)`  
λΉ„λ™κΈ°: `compareSync(data, encrypted)`

- data : λΉ„κµν•  λ°μ΄ν„°
- encrypted : λΉ„κµν•  λ°μ΄ν„°
- cb : λ°μ΄ν„°κ°€ λΉ„κµλλ©΄ μ‹¤ν–‰λλ” μ½λ°± (μ„ νƒ)

```js
const bcrypt = require("bcrypt");

bcrypt.compare(password, loginUser.password);
bcrypt.compareSync(password, loginUser.password);
```

μ°Έκ³  μ‚¬μ΄νΈ

- [κ³µμ‹ λ¬Έμ„ - node.js v.20.xx.x](https://nodejs.org/docs/latest-v20.x/api/crypto.html#crypto)
- [Bcrypt κΉƒν—λΈ](https://github.com/kelektiv/node.bcrypt.js)
- [[Node.js] cryptoλ΅ λΉ„λ°€λ²νΈ μ•”νΈν™”ν•κΈ°](https://velog.io/@jiheon/Node.js-crypto%EB%A1%9C-%EB%B9%84%EB%B0%80%EB%B2%88%ED%98%B8-%EC%95%94%ED%98%B8%ED%99%94%ED%95%98%EA%B8%B0#crypto-vs-bcrypt)
- [μ™ Password hashingμ‹ Bcrypt κ°€ μ¶”μ²λμ–΄μ§κΉ?](https://velog.io/@kylexid/%EC%99%9C-bcrypt-%EC%95%94%ED%98%B8%ED%99%94-%EB%B0%A9%EC%8B%9D%EC%9D%B4-%EC%B6%94%EC%B2%9C%EB%90%98%EC%96%B4%EC%A7%88%EA%B9%8C#%EC%9A%94%EC%95%BD)
