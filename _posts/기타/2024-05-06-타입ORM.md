---
title: TypeORM
date: 2024-05-06 10:24:00 +09:00
categories: ["ê¸°íƒ€", "TypeORM"]
tags: []
toc: true
toc_sticky: true
---

í•œê¸€ë¡œ ë²ˆì—­ëœ ì‚¬ì´íŠ¸ë¥¼ ë³´ê³ , ì •ë¦¬í•œ ê¸€ì…ë‹ˆë‹¤.
[https://orkhan.gitbook.io/typeorm/readme_ko](https://orkhan.gitbook.io/typeorm/readme_ko)

ì‚¬ìš©ë°©ë²•ì´ ë³€ê²½ë˜ì–´ íƒ€ì…ì˜¤ì•Œì—  ê³µì‹í˜ì´ì§€ë„ ê¼­ í™•ì¸í•´ì•¼í•©ë‹ˆë‹¤.
[https://typeorm.io/](https://typeorm.io/)

## typeorm

### ğŸ§ í”„ë¡œì íŠ¸ ì‹œì‘í•˜ê¸°

#### 1. ì„¤ì¹˜ ëª…ë ¹ì–´

```
npm install typeorm reflect-metadata
```

#### 2. app.tsì— ëª¨ë“ˆì„ ë“±ë¡

```js
import "reflect-metadata";
```

#### 3. DB ë“œë¼ì´ë²„ ì„¤ì¹˜ - mariaDB ë˜ëŠ” mysql

```
npm install mysql2
```

#### 4. íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ í™˜ê²½ ì„¤ì •

- 3.3 ë²„ì „ ì´ìƒ
- tsconfig.jsonì— ë‹¤ìŒ ì„¤ì • ì¶”ê°€

```json
"emitDecoratorMetadata": true,
"experimentalDecorators": true,
```

#### 5. `data-source.ts`íŒŒì¼ì— ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ê²°í•˜ëŠ” ì½”ë“œ ì‘ì„±í•˜ê¸°

```ts
export const AppDataSource = new DataSource({
  type: "postgres",
  host: "localhost",
  port: 5432,
  username: "test",
  password: "test",
  database: "test",
  synchronize: true,
  logging: true,
  entities: [Post, Category],
  subscribers: [],
  migrations: []
});
```

### ğŸ§ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
MyProject
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ entity       // ëª¨ë¸ ì €ì¥
â”‚   â”‚   â””â”€â”€ User.ts  // ìƒ˜í”Œ ëª¨ë¸
â”‚   â”œâ”€â”€ migration    // ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ì €ì¥
â”‚   â”œâ”€â”€ data-source.ts // ORMê³¼ databaseì„ ì—°ê²°í•˜ëŠ” ì½”ë“œ ì‘ì„±
â”‚   â””â”€â”€ index.ts     // ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ì 
â”œâ”€â”€ .gitignore       // gitignore file
â”œâ”€â”€ package.json
â”œâ”€â”€ README.md
â””â”€â”€ tsconfig.json
```

### ğŸ§ ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ê²°í•˜ê¸°

createConnectionì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ê²°í•  ìˆ˜ ìˆë‹¤. ì£¼ë¡œ `index.ts` ë˜ëŠ” `app.ts`ì— ì‘ì„±í•œë‹¤.

```ts
import "reflect-metadata";
import { createConnection } from "typeorm";
import { Photo } from "./entity/Photo";

createConnection({
  type: "mysql",
  host: "localhost",
  port: 3306,
  username: "root",
  password: "admin",
  database: "test",
  entities: [Photo],
  synchronize: true,
  logging: false
})
  .then((connection) => {
    // here you can start to work with your entities
  })
  .catch((error) => console.log(error));
```

#### âœ…type

typeì—ëŠ” ì‚¬ìš©í•œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì§€ì •í•œë‹¤.

- mysql, mariadb, postgres, cockroachdb, sqlite, mssql, oracle, cordova, nativescript, react-native, expo, or mongodb

#### âœ…entities

entities ëª©ë¡ì´ë©°, ì‚¬ìš©í•  ì—”í„°í‹°ë“¤ì„ ì¶”ê°€í•´ì•¼í•œë‹¤.

- ë§¤ë²ˆ ì—”í„°í‹°ë¥¼ ì„¤ì •ì— ì¶”ê°€í•˜ê¸°ëŠ” ë¶ˆí¸í•˜ê¸° ë•Œë¬¸ì— ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¥¼ ì‘ì„±í•˜ì—¬, ëª¨ë“  ì—”í„°í‹°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆë‹¤.

```ts
entities: [
        __dirname + "/entity/*.js"
    ],
```

#### âœ…synchronize

synchronizeë¥¼ trueë¡œ ì„¤ì •í•´ë‘ë©´, ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ë  ë•Œë§ˆë‹¤ ì—”í„°í‹°ê°€ ë°ì´í„°ë² ì´ìŠ¤ì™€ ë™ê¸°í™”ëœë‹¤.

### ğŸ§ í…Œì´ë¸” ìƒì„±í•˜ê¸°

íƒ€ì…ì˜¤ì•Œì— ì—ì„œì˜ ëª¨ë¸ì€ ë°ì´í„°ë² ì´ìŠ¤ì˜ í…Œì´ë¸”ì´ë‹¤. ëª¨ë¸ì„ í†µí•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤.

#### âœ…`@Entity`ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë¸ ì‘ì„±í•˜ê¸°

```ts
import { Entity } from "typeorm";

@Entity()
export class Photo {
  id: number;
  name: string;
  description: string;
  filename: string;
  views: number;
  isPublished: boolean;
}
```

#### âœ…`@Column`ë¥¼ ì‚¬ìš©í•˜ì—¬ í…Œì´ë¸” ì—´ ì¶”ê°€í•˜ê¸°

ìƒë‹¨ì˜ `@Entity`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë§Œë“  ëª¨ë¸ì„ ë³´ë©´, í…Œì´ë¸”ì— ì—´ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤. `@Column`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì—´ì„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.

```ts
import { Entity, Column } from "typeorm";

@Entity()
export class Photo {
  @Column()
  id: number;

  @Column()
  name: string;

  @Column()
  description: string;

  @Column()
  filename: string;

  @Column()
  views: number;

  @Column()
  isPublished: boolean;
}
```

`@Column()`ì— ì˜µì…˜ ê°’ì„ ì…ë ¥í•  ìˆ˜ë„ ìˆë‹¤.

@ì˜ˆì‹œ 1

```ts
@Column({nullable:true,unique:true})
```

ìœ„ì˜ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì˜µì…˜ì„ ì§€ì •í•œ ê²ƒì´ë‹¤.

- nullì„ í—ˆìš©í•˜ëŠ”ì§€ ê²°ì •í•˜ëŠ” `nullable`
- ìœ ì¼í•œ ê°’ì„ ì˜ë¯¸í•˜ëŠ” `unique`

@ì˜ˆì‹œ 2

```ts
@Column({ length: 15, nullable: true, comment: 'ì „í™”ë²ˆí˜¸' })
```

ìœ„ì˜ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì˜µì…˜ì„ ì§€ì •í•œ ê²ƒì´ë‹¤.

- nullì„ í—ˆìš©í•˜ëŠ”ì§€ ê²°ì •í•˜ëŠ” `nullable`
- ì „ì²´ ê¸¸ì´ë¥¼ ì§€ì •í•˜ëŠ” `length`
- ì¹¼ëŸ¼ì— ëŒ€í•œ ì„¤ëª…ì„ ì‘ì„±í•œ `comment`

#### âœ… `@PrimaryColumn`ë¥¼ ì‚¬ìš©í•˜ì—¬ ê¸°ë³¸ ì—´ ìƒì„±í•˜ê¸°

ìš°ë¦¬ëŠ” `@Column`ì„ ì‚¬ìš©í•˜ì—¬ í…Œì´ë¸”ì— ì—´ì„ ì¶”ê°€í•´ì£¼ì—ˆë‹¤. í•˜ì§€ë§Œ í…Œì´ë¸”ì—ëŠ” ê¸°ë³¸ í‚¤ê°€ ìˆëŠ” ì—´ì´ ê¼­ ì¡´ì¬í•´ì•¼í•œë‹¤. ì´ëŠ” `@PrimaryColumn`í•˜ì—¬ ê¸°ë³¸ ì—´ì„ ì§€ì •í•´ì¤„ ìˆ˜ ìˆë‹¤.

ë‹¤ìŒì€ id ì—´ì„ ê¸°ë³¸ ì—´ë¡œ ìƒì„±í•œ ì½”ë“œ ì˜ˆì‹œì´ë‹¤.

```ts
import { Entity, Column, PrimaryColumn } from "typeorm";

@Entity()
export class Photo {
  @PrimaryColumn()
  id: number;

  @Column()
  name: string;

  @Column()
  description: string;

  @Column()
  filename: string;

  @Column()
  views: number;

  @Column()
  isPublished: boolean;
}
```

#### âœ…`@PrimaryGeneratedColumn`ë¥¼ ì‚¬ìš©í•˜ì—¬ ê¸°ë³¸ ì—´ ìƒì„±í•˜ê¸°

`@PrimaryColumn`ì„ ì‚¬ìš©í•˜ì—¬ ê¸°ë³¸ ì—´ì„ ì„¤ì •í•´ì£¼ì—ˆë‹¤. í•˜ì§€ë§Œ idëŠ” ìë™ìœ¼ë¡œ ìƒì„±(ìë™ìœ¼ë¡œ ì¦ê°€)ë˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤. ì´ë ‡ê²Œ ìë™ ìƒì„±ì„ í•˜ê¸° ìœ„í•´ì„œëŠ” `@PrimaryGeneratedColumn`ì„ ì‚¬ìš©í•´ì•¼í•œë‹¤.

ë‹¤ìŒì€ `@PrimaryGeneratedColumn`ì„ ì‚¬ìš©í•˜ì—¬ idê°€ ìë™ìœ¼ë¡œ ìƒì„±ë˜ê²Œ í•˜ëŠ” ì½”ë“œ ì˜ˆì‹œì´ë‹¤.

```ts
import { Entity, Column, PrimaryGeneratedColumn } from "typeorm";

@Entity()
export class Photo {
  @PrimaryGeneratedColumn()
  id: number;

  @Column()
  name: string;

  @Column()
  description: string;

  @Column()
  filename: string;

  @Column()
  views: number;

  @Column()
  isPublished: boolean;
}
```

### ğŸ§ ë°ì´í„°ë² ì´ìŠ¤ ê´€ê³„ ìƒì„±í•˜ê¸°

#### âœ…`@OneToOne`

`@OneToOne`ì„ ì‚¬ìš©í•˜ë©´ 1:1 ê´€ê³„ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìœ¼ë©°, `type => ì—”í„°í‹° í´ë˜ìŠ¤`ë¥¼ ì‚¬ìš©í•˜ì—¬ ê´€ê³„ë¥¼ ë§Œë“¤ê³ ì í•˜ëŠ” ì—”í„°í‹°ì˜ í´ë˜ìŠ¤ë¥¼ ëª…ì‹œí•´ì£¼ì–´ì•¼í•œë‹¤.

ê´€ê³„ë¥¼ ì†Œìœ í•˜ëŠ” ìª½ì— `@JoinColumn`ë¥¼ ì‘ì„±í•˜ì—¬ ê´€ê³„ë¥¼ ì†Œìœ í•˜ê³  ìˆìŒì„ ëª…ì‹œí•´ì£¼ì–´ì•¼í•œë‹¤.

ì˜ˆì‹œ ì½”ë“œ

```ts
import {
  Entity,
  Column,
  PrimaryGeneratedColumn,
  OneToOne,
  JoinColumn
} from "typeorm";
import { Photo } from "./Photo";

@Entity()
export class PhotoMetadata {
  @PrimaryGeneratedColumn()
  id: number;

  @Column("int")
  height: number;

  @Column("int")
  width: number;

  @OneToOne((type) => Photo)
  @JoinColumn()
  photo: Photo;
}
```

#### âœ…`@OneToMany`/`@ManyToOne`

`@OneToMany`ì€ 1:Nì˜ ê´€ê³„(ì¼ëŒ€ë‹¤)ë¥¼ ìƒì„±í•  ë•Œ ì‚¬ìš©í•˜ê³ , `@ManyToOne`ì€ N:1 ê´€ê³„(ë‹¤ëŒ€ì¼)ë¥¼ ìƒì„±í•  ë•Œ ì‚¬ìš©í•œë‹¤. `@OneToMany`ëŠ” `@ManyToOne`ì—†ì´ëŠ” ì¡´ì¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì´ ê´€ê³„ì—ì„œ ì†Œìœ ìëŠ” í•­ìƒ ë‹¤ëŒ€ì¼(`@ManyToOne`)ì…ë‹ˆë‹¤. `@ManyToOne`ì‚¬ìš©í•˜ëŠ” ê°ì²´ê°€ ê´€ë ¨ ê°ì²´ì˜ idë¥¼ ì €ì¥í•œë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, í•˜ë‚˜ì˜ ì£¼ë¬¸ì´ ì—¬ëŸ¬ê°œì˜ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ ì£¼ë¬¸ì€ 1ì´ê³ , ì œí’ˆì€ Nì´ ë©ë‹ˆë‹¤. ì´ ê´€ê³„ë¥¼ êµ¬í˜„í•  ë•Œ ì£¼ë¬¸ ì—”í„°í‹°ì—ëŠ” ì—¬ëŸ¬ ì œí’ˆì´ ìˆìœ¼ë¯€ë¡œ ì£¼ë¬¸ ì—”í„°í‹°ê°€ **"ë‹¤"** ì´ë©°, ì´ê²ƒì´ ì¼ëŒ€ë‹¤ ê´€ê³„(`@OneToMany`)ì…ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì œí’ˆ ì—”í„°í‹°ì—ëŠ” ì£¼ë¬¸ê³¼ ê´€ë ¨ëœ ì£¼ë¬¸ idê°€ ìˆìœ¼ë¯€ë¡œ, ì—¬ëŸ¬ ì œí’ˆì´ í•˜ë‚˜ì˜ ì£¼ë¬¸ì— ì†í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ê²ƒì´ ë‹¤ëŒ€ì¼ ê´€ê³„(`@ManyToOne`)ì…ë‹ˆë‹¤.

#ì£¼ë¬¸ ì—”í„°í‹°

```ts
// Order.ts
import { Entity, PrimaryGeneratedColumn, Column, OneToMany } from "typeorm";
import { Product } from "./Product";

@Entity()
export class Order {
  @PrimaryGeneratedColumn()
  id: number;

  @Column()
  orderName: string;

  @OneToMany(() => Product, (product) => product.order)
  products: Product[];
}
```

#ì œí’ˆ ì—”í„°í‹°

```ts
// Product.ts
import { Entity, PrimaryGeneratedColumn, Column, ManyToOne } from "typeorm";
import { Order } from "./Order";

@Entity()
export class Product {
  @PrimaryGeneratedColumn()
  id: number;

  @Column()
  productName: string;

  @ManyToOne(() => Order, (order) => order.products)
  order: Order;
}
```

### ğŸ§ ë°ì´í„°ë² ì´ìŠ¤ì— ë°ì´í„° ì¶”ê°€í•˜ê¸°

`index.ts` ë¥¼ ì‹¤í–‰í•˜ë©´ ìë™ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì™€ì˜ ì—°ê²°ì´ ì´ˆê¸°í™”ê°€ ë˜ë©°, í…Œì´ë¸”ì´ ìƒì„±ëœë‹¤.

`save`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.

```ts
import { Photo } from "./entity/Photo";
import { AppDataSource } from "./index";

const photo = new Photo();
photo.name = "Me and Bears";
photo.description = "I am near polar bears";
photo.filename = "photo-with-bears.jpg";
photo.views = 1;
photo.isPublished = true;

await AppDataSource.manager.save(photo);
console.log("Photo has been saved. Photo id is", photo.id);
```

### ğŸ§ ë°ì´í„°ë² ì´ìŠ¤ì— ë°ì´í„° ì¡°íšŒí•˜ê¸°

`find()`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì—¬ëŸ¬ê°œì˜ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê³ , `findOne()`ì„ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • ë°ì´í„°ë¥¼ ì¡°íšŒí•œë‹¤.

ì˜ˆì „ ë©”ì†Œë“œ

- `find()`: ì „ì²´ ì¡°íšŒ
- `find({ì¡°ê±´})`: ì¡°ê±´ì— ë§ëŠ” ëª¨ë“  ë°ì´í„° ì¡°íšŒ
- `findOne(id)`: ì•„ì´ë””ê°’ì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„° ì¡°íšŒ
- `findOne({ì¡°ê±´})`: ì¡°ê±´ì— ë§ëŠ” ë°ì´í„° ì¡°íšŒ

ë³€ê²½ëœ ë©”ì†Œë“œ

- `find()`: ì „ì²´ ì¡°íšŒ
- `findBy({ì¡°ê±´})`: ì¡°ê±´ì— ë§ëŠ” ëª¨ë“  ë°ì´í„° ì¡°íšŒ
- `findOneBy({ì¡°ê±´})`: : ì¡°ê±´ì— ë§ëŠ” ë°ì´í„° ì¡°íšŒ
- `findAndCount()`: ëª¨ë“  ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê³ , ë°ì´í„°ì˜ ê°¯ìˆ˜ ë°˜í™˜

ì˜ˆì‹œ ì½”ë“œ

```ts
import { Photo } from "./entity/Photo";
import { AppDataSource } from "./index";

const photoRepository = AppDataSource.getRepository(Photo);
const allPhotos = await photoRepository.find();
console.log("All photos from the db: ", allPhotos);

const firstPhoto = await photoRepository.findOneBy({
  id: 1
});
console.log("First photo from the db: ", firstPhoto);

const meAndBearsPhoto = await photoRepository.findOneBy({
  name: "Me and Bears"
});
console.log("Me and Bears photo from the db: ", meAndBearsPhoto);

const allViewedPhotos = await photoRepository.findBy({ views: 1 });
console.log("All viewed photos: ", allViewedPhotos);

const allPublishedPhotos = await photoRepository.findBy({ isPublished: true });
console.log("All published photos: ", allPublishedPhotos);

const [photos, photosCount] = await photoRepository.findAndCount();
console.log("All photos: ", photos);
console.log("Photos count: ", photosCount);
```

### ğŸ§ ë°ì´í„°ë² ì´ìŠ¤ì— ë°ì´í„° ì—…ë°ì´íŠ¸í•˜ê¸°

`findOneBy`ì„ ì‚¬ìš©í•˜ì—¬ ì—…ë°ì´íŠ¸í•  ë°ì´í„°ë¥¼ ì°¾ê³ , `save`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤.

ì˜ˆì‹œ ì½”ë“œ

```ts
import { Photo } from "./entity/Photo";
import { AppDataSource } from "./index";

const photoRepository = AppDataSource.getRepository(Photo);
const photoToUpdate = await photoRepository.findOneBy({
  id: 1
});
photoToUpdate.name = "Me, my friends and polar bears";
await photoRepository.save(photoToUpdate);
```

### ğŸ§ ë°ì´í„°ë² ì´ìŠ¤ì— ë°ì´í„° ì‚­ì œ

`findOneBy`ì„ ì‚¬ìš©í•˜ì—¬ ì‚­ì œí•  ë°ì´í„°ë¥¼ ì°¾ê³ , `remove`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì‚­ì œí•œë‹¤.

ì˜ˆì‹œ ì½”ë“œ

```ts
import { Photo } from "./entity/Photo";
import { AppDataSource } from "./index";

const photoRepository = AppDataSource.getRepository(Photo);
const photoToRemove = await photoRepository.findOneBy({
  id: 1
});
await photoRepository.remove(photoToRemove);
```
